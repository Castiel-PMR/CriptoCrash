<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoLiquidations - Real-Time Liquidation Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'mono': ['JetBrains Mono', 'monospace'],
                        'sans': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'cyber-dark': '#0a0a0a',
                        'cyber-gray': '#111111',
                        'cyber-border': '#1a1a1a',
                        'long-red': '#ef4444',
                        'short-green': '#10b981',
                        'accent-blue': '#3b82f6',
                        'accent-yellow': '#f59e0b',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-subtle': 'bounce 2s ease-in-out infinite',
                    }
                }
            }
        };
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #111111 50%, #0a0a0a 100%);
            overflow: hidden;
        }
        
        .grid-bg {
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-move 20s linear infinite;
        }
        
        @keyframes grid-move {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }
        
        .liquidation-block {
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 2px solid;
        }
        
        .long-block {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #fee2e2;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.3);
        }
        
        .short-block {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #d1fae5;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
        }
        
        .impact-zone {
            background: linear-gradient(0deg, rgba(59, 130, 246, 0.2) 0%, transparent 100%);
            border-top: 2px solid rgba(59, 130, 246, 0.5);
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .stats-glow {
            text-shadow: 0 0 10px currentColor;
        }
    </style>
</head>
<body class="bg-cyber-dark text-white font-sans">
    <!-- Background Grid -->
    <div class="fixed inset-0 grid-bg opacity-30 pointer-events-none"></div>
    
    <!-- Header Stats Panel -->
    <div class="fixed top-0 left-0 right-0 z-50 bg-cyber-gray/90 backdrop-blur-md border-b border-cyber-border">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-8">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-accent-blue to-accent-yellow bg-clip-text text-transparent">
                        CryptoLiquidations
                    </h1>
                    <div class="flex items-center space-x-6">
                        <!-- @STATE: totalLongs:number = 0 -->
                        <div class="text-center">
                            <div class="text-sm text-gray-400">Total Longs</div>
                            <div class="text-xl font-mono font-bold text-long-red stats-glow" data-bind="totalLongs">$24.7M</div>
                        </div>
                        <!-- @STATE: totalShorts:number = 0 -->
                        <div class="text-center">
                            <div class="text-sm text-gray-400">Total Shorts</div>
                            <div class="text-xl font-mono font-bold text-short-green stats-glow" data-bind="totalShorts">$31.2M</div>
                        </div>
                        <!-- @STATE: activeLiquidations:number = 0 -->
                        <div class="text-center">
                            <div class="text-sm text-gray-400">Active Feed</div>
                            <div class="text-xl font-mono font-bold text-accent-blue stats-glow" data-bind="activeLiquidations">127</div>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Connection Status -->
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-short-green rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-400">Live Feed</span>
                    </div>
                    
                    <!-- Speed Control -->
                    <!-- @STATE: animationSpeed:number = 1 -->
                    <div class="flex items-center space-x-2">
                        <label class="text-sm text-gray-400">Speed:</label>
                        <input 
                            type="range" 
                            min="0.5" 
                            max="3" 
                            step="0.5" 
                            value="1" 
                            class="w-20 h-2 bg-cyber-border rounded-lg appearance-none cursor-pointer"
                            data-event="change:updateSpeed"
                        >
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Canvas Container -->
    <div class="relative w-full h-screen pt-20">
        <!-- @COMPONENT: LiquidationCanvas [width: window.innerWidth, height: window.innerHeight - 80] -->
        <canvas 
            id="liquidationCanvas" 
            class="absolute inset-0 w-full h-full"
            data-implementation="Canvas-based physics animation system for falling liquidations"
        ></canvas>
        <!-- @END_COMPONENT: LiquidationCanvas -->
        
        <!-- Impact Zone Indicator -->
        <div class="absolute bottom-0 left-0 right-0 h-16 impact-zone pointer-events-none">
            <div class="h-full flex items-center justify-center">
                <span class="text-accent-blue text-sm font-mono opacity-60">IMPACT ZONE</span>
            </div>
        </div>
        
        <!-- Side Stats Panels -->
        <div class="absolute left-4 top-1/2 transform -translate-y-1/2 space-y-4">
            <!-- @COMPONENT: LiveStatsPanel [position: left] -->
            <div class="bg-cyber-gray/90 backdrop-blur-md rounded-lg border border-cyber-border p-4 w-64">
                <h3 class="text-lg font-semibold mb-3 text-accent-blue">Recent Liquidations</h3>
                <div class="space-y-2 text-sm font-mono" data-mock="true">
                    <!-- @MAP: recentLiquidations.slice(0, 5).map(liquidation => ( -->
                    <div class="flex justify-between items-center py-1 border-b border-cyber-border/50">
                        <span class="text-accent-yellow font-semibold">BTC</span>
                        <span class="text-long-red">-$2.3M</span>
                    </div>
                    <div class="flex justify-between items-center py-1 border-b border-cyber-border/50">
                        <span class="text-accent-yellow font-semibold">ETH</span>
                        <span class="text-short-green">+$1.8M</span>
                    </div>
                    <div class="flex justify-between items-center py-1 border-b border-cyber-border/50">
                        <span class="text-accent-yellow font-semibold">ADA</span>
                        <span class="text-short-green">+$890K</span>
                    </div>
                    <div class="flex justify-between items-center py-1 border-b border-cyber-border/50">
                        <span class="text-accent-yellow font-semibold">XRP</span>
                        <span class="text-long-red">-$1.2M</span>
                    </div>
                    <div class="flex justify-between items-center py-1">
                        <span class="text-accent-yellow font-semibold">SOL</span>
                        <span class="text-short-green">+$650K</span>
                    </div>
                    <!-- @END_MAP )) -->
                </div>
            </div>
            <!-- @END_COMPONENT: LiveStatsPanel -->
        </div>
        
        <div class="absolute right-4 top-1/2 transform -translate-y-1/2 space-y-4">
            <!-- @COMPONENT: MarketSentiment [position: right] -->
            <div class="bg-cyber-gray/90 backdrop-blur-md rounded-lg border border-cyber-border p-4 w-64">
                <h3 class="text-lg font-semibold mb-3 text-accent-blue">Market Sentiment</h3>
                <div class="space-y-4">
                    <!-- Long/Short Ratio -->
                    <div>
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-long-red">Longs</span>
                            <span class="text-short-green">Shorts</span>
                        </div>
                        <div class="w-full bg-cyber-border rounded-full h-3 overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-long-red to-short-green" 
                                 style="background: linear-gradient(90deg, #ef4444 0%, #ef4444 44%, #10b981 44%, #10b981 100%)">
                            </div>
                        </div>
                        <div class="flex justify-between text-xs mt-1 text-gray-400">
                            <span>44%</span>
                            <span>56%</span>
                        </div>
                    </div>
                    
                    <!-- Liquidation Volume Chart -->
                    <div>
                        <div class="text-sm text-gray-400 mb-2">24h Volume</div>
                        <div class="flex items-end space-x-1 h-16">
                            <!-- @FUNCTIONALITY: Mini bar chart showing liquidation volumes over time -->
                            <div class="bg-long-red w-2 h-8 rounded-t opacity-60" data-mock="true"></div>
                            <div class="bg-short-green w-2 h-12 rounded-t opacity-60" data-mock="true"></div>
                            <div class="bg-long-red w-2 h-6 rounded-t opacity-60" data-mock="true"></div>
                            <div class="bg-short-green w-2 h-16 rounded-t" data-mock="true"></div>
                            <div class="bg-long-red w-2 h-10 rounded-t opacity-60" data-mock="true"></div>
                            <div class="bg-short-green w-2 h-14 rounded-t opacity-80" data-mock="true"></div>
                            <div class="bg-long-red w-2 h-4 rounded-t opacity-60" data-mock="true"></div>
                            <div class="bg-short-green w-2 h-11 rounded-t opacity-70" data-mock="true"></div>
                            <div class="bg-long-red w-2 h-7 rounded-t opacity-60" data-mock="true"></div>
                            <div class="bg-short-green w-2 h-13 rounded-t opacity-90" data-mock="true"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- @END_COMPONENT: MarketSentiment -->
        </div>
    </div>
    
    <!-- Floating Action Controls -->
    <div class="fixed bottom-6 right-6 z-50">
        <div class="flex flex-col space-y-3">
            <!-- @STATE: isPaused:boolean = false -->
            <button 
                class="bg-accent-blue hover:bg-blue-600 text-white p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110"
                data-event="click:togglePause"
                data-implementation="Pause/resume the falling animation system"
            >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                </svg>
            </button>
            
            <!-- @STATE: showSettings:boolean = false -->
            <button 
                class="bg-cyber-gray hover:bg-gray-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110"
                data-event="click:toggleSettings"
            >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // TODO: Implement real-time WebSocket connection to CoinGlass API or Binance Futures
        // TODO: Replace mock data with actual liquidation feeds
        // TODO: Add object pooling for better memory management
        // TODO: Implement proper error handling for WebSocket disconnections
        
        (function() {
            // Canvas setup and animation system
            const canvas = document.getElementById('liquidationCanvas');
            const ctx = canvas.getContext('2d');
            
            // Resize canvas to full screen
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight - 80; // Account for header
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Animation state
            let animationSpeed = 1;
            let isPaused = false;
            let liquidations = [];
            let particles = [];
            let lastTime = 0;
            
            // Mock liquidation data structure
            const mockCoins = ['BTC', 'ETH', 'ADA', 'XRP', 'SOL', 'MATIC', 'DOT', 'LINK', 'UNI', 'AAVE'];
            
            // Liquidation class
            class Liquidation {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.width = Math.random() * 40 + 60; // 60-100px wide
                    this.height = Math.random() * 20 + 30; // 30-50px tall
                    this.velocity = Math.random() * 2 + 1; // Base falling speed
                    this.rotation = 0;
                    this.rotationSpeed = (Math.random() - 0.5) * 0.05;
                    
                    // Mock data
                    this.coin = mockCoins[Math.floor(Math.random() * mockCoins.length)];
                    this.isLong = Math.random() < 0.6; // 60% longs (market typically bearish)
                    this.amount = (Math.random() * 5000000 + 100000).toFixed(0); // $100K - $5M
                    this.price = (Math.random() * 100000 + 1000).toFixed(2);
                    
                    // Visual properties
                    this.opacity = 1;
                    this.isExploding = false;
                    this.explosionTime = 0;
                }
                
                update(deltaTime) {
                    if (this.isExploding) {
                        this.explosionTime += deltaTime;
                        this.opacity = Math.max(0, 1 - this.explosionTime / 500);
                        return this.explosionTime < 500;
                    }
                    
                    // Physics
                    this.velocity += 0.05 * animationSpeed; // Gravity
                    this.y += this.velocity * animationSpeed;
                    this.rotation += this.rotationSpeed * animationSpeed;
                    
                    // Check if hit bottom
                    if (this.y + this.height >= canvas.height - 60) {
                        this.explode();
                        return true;
                    }
                    
                    return this.y < canvas.height + this.height;
                }
                
                explode() {
                    this.isExploding = true;
                    this.explosionTime = 0;
                    
                    // Create particles
                    for (let i = 0; i < 15; i++) {
                        particles.push(new Particle(
                            this.x + this.width / 2,
                            this.y + this.height / 2,
                            this.isLong
                        ));
                    }
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.opacity;
                    ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
                    ctx.rotate(this.rotation);
                    
                    // Block background
                    const gradient = ctx.createLinearGradient(-this.width/2, -this.height/2, this.width/2, this.height/2);
                    if (this.isLong) {
                        gradient.addColorStop(0, '#ef4444');
                        gradient.addColorStop(1, '#dc2626');
                        ctx.shadowColor = '#ef4444';
                    } else {
                        gradient.addColorStop(0, '#10b981');
                        gradient.addColorStop(1, '#059669');
                        ctx.shadowColor = '#10b981';
                    }
                    
                    ctx.shadowBlur = 15;
                    ctx.fillStyle = gradient;
                    ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
                    
                    // Border
                    ctx.strokeStyle = this.isLong ? '#fee2e2' : '#d1fae5';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(-this.width/2, -this.height/2, this.width, this.height);
                    
                    // Text
                    ctx.shadowBlur = 0;
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 12px JetBrains Mono';
                    ctx.textAlign = 'center';
                    
                    // Coin symbol
                    ctx.fillText(this.coin, 0, -8);
                    
                    // Amount
                    ctx.font = '10px JetBrains Mono';
                    const formattedAmount = '$' + (parseInt(this.amount) / 1000000).toFixed(1) + 'M';
                    ctx.fillText(formattedAmount, 0, 6);
                    
                    ctx.restore();
                }
            }
            
            // Particle class for explosion effects
            class Particle {
                constructor(x, y, isLong) {
                    this.x = x;
                    this.y = y;
                    this.vx = (Math.random() - 0.5) * 8;
                    this.vy = (Math.random() - 0.5) * 8 - 2;
                    this.life = 1;
                    this.decay = Math.random() * 0.02 + 0.01;
                    this.color = isLong ? '#ef4444' : '#10b981';
                    this.size = Math.random() * 4 + 2;
                }
                
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += 0.1; // Gravity
                    this.life -= this.decay;
                    this.size *= 0.98;
                    
                    return this.life > 0;
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.life;
                    ctx.fillStyle = this.color;
                    ctx.shadowColor = this.color;
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }
            
            // Spawn liquidations
            function spawnLiquidation() {
                if (Math.random() < 0.7) { // 70% chance to spawn
                    const x = Math.random() * (canvas.width - 100);
                    liquidations.push(new Liquidation(x, -50));
                }
            }
            
            // Main animation loop
            function animate(currentTime) {
                const deltaTime = currentTime - lastTime;
                lastTime = currentTime;
                
                if (!isPaused) {
                    // Clear canvas
                    ctx.fillStyle = 'rgba(10, 10, 10, 0.1)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Spawn new liquidations
                    if (Math.random() < 0.05 * animationSpeed) { // Adjusted spawn rate
                        spawnLiquidation();
                    }
                    
                    // Update and draw liquidations
                    liquidations = liquidations.filter(liquidation => {
                        const alive = liquidation.update(deltaTime);
                        if (alive) {
                            liquidation.draw();
                        }
                        return alive;
                    });
                    
                    // Update and draw particles
                    particles = particles.filter(particle => {
                        const alive = particle.update();
                        if (alive) {
                            particle.draw();
                        }
                        return alive;
                    });
                }
                
                requestAnimationFrame(animate);
            }
            
            // Event handlers
            document.querySelector('[data-event="change:updateSpeed"]').addEventListener('change', (e) => {
                animationSpeed = parseFloat(e.target.value);
            });
            
            document.querySelector('[data-event="click:togglePause"]').addEventListener('click', () => {
                isPaused = !isPaused;
            });
            
            // Start animation
            requestAnimationFrame(animate);
            
            // Mock real-time data updates for stats
            function updateStats() {
                // TODO: Replace with real WebSocket data
                const totalLongs = document.querySelector('[data-bind="totalLongs"]');
                const totalShorts = document.querySelector('[data-bind="totalShorts"]');
                const activeLiquidations = document.querySelector('[data-bind="activeLiquidations"]');
                
                if (totalLongs && totalShorts && activeLiquidations) {
                    // Simulate changing values
                    const longValue = (Math.random() * 50 + 10).toFixed(1);
                    const shortValue = (Math.random() * 60 + 15).toFixed(1);
                    const activeValue = Math.floor(Math.random() * 200 + 50);
                    
                    totalLongs.textContent = `$${longValue}M`;
                    totalShorts.textContent = `$${shortValue}M`;
                    activeLiquidations.textContent = activeValue.toString();
                }
            }
            
            // Update stats every 3 seconds
            setInterval(updateStats, 3000);
            
            // Initialize with some liquidations
            setTimeout(() => {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => spawnLiquidation(), i * 500);
                }
            }, 1000);
        })();
    </script>
</body>
</html>