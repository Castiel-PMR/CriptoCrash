# üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã –≥—Ä–∞—Ñ–∏–∫–∞

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã

### 1. **Fetch –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥**

```tsx
// Fetch –¥–∞–Ω–Ω—ã—Ö —Å Binance API
useEffect(() => {
  const fetchCandleData = async () => {
    try {
      // –ó–∞–ø—Ä–æ—Å –∫ Binance API
      let response = await fetch(
        `https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=${timeframe}&limit=${candleLimit}`
      );
      data = await response.json();
      
      // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
      const validCandles = data.map((kline: any[]) => ({
        timestamp: kline[0],
        open: parseFloat(kline[1]),
        high: parseFloat(kline[2]),
        low: parseFloat(kline[3]),
        close: parseFloat(kline[4]),    // ‚ö° –¢–ï–ö–£–©–ê–Ø –¶–ï–ù–ê
        volume: parseFloat(kline[5]),
      }));
      
      setCandles(validCandles);           // ‚ö° –û–±–Ω–æ–≤–ª—è–µ–º state
      setLastUpdateTime(Date.now());     // ‚ö° –§–∏–∫—Å–∏—Ä—É–µ–º –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    }
  };

  fetchCandleData();                               // –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ä–∞–∑—É
  const interval = setInterval(fetchCandleData, 10000);  // ‚ö° –ü–æ–≤—Ç–æ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
  return () => clearInterval(interval);
}, [symbol, timeframe, candleLimit, updateInterval]);
```

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö**

```tsx
const drawChart = useCallback((ctx, width, height) => {
  // ... –∫–æ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞
  
  // –ë–µ—Ä–µ–º –ü–û–°–õ–ï–î–ù–Æ–Æ —Å–≤–µ—á—É = —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
  const lastCandle = candles[candles.length - 1];
  if (lastCandle) {
    const currentPrice = lastCandle.close;  // ‚ö° –¢–ï–ö–£–©–ê–Ø –¶–ï–ù–ê
    
    // –†–∏—Å—É–µ–º –∫—Ä–∞—Å–Ω—É—é –ª–∏–Ω–∏—é —Å —Ü–µ–Ω–æ–π
    ctx.strokeStyle = '#ff6666';
    ctx.fillText(formatPrice(currentPrice), ...);
    
    // –ü—É–ª—å—Å–∏—Ä—É—é—â–∞—è —Ç–æ—á–∫–∞ "–∂–∏–≤–æ–≥–æ" –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    const timeSinceUpdate = Date.now() - lastUpdateTime;
    if (timeSinceUpdate < 20000) {  // –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–µ–∂–µ–µ 20 —Å–µ–∫
      const alpha = 0.6 + 0.4 * Math.sin(Date.now() * 0.005); // –ü—É–ª—å—Å–∞—Ü–∏—è
      ctx.fillStyle = '#00ff88';
      ctx.arc(...); // –ó–µ–ª–µ–Ω–∞—è —Ç–æ—á–∫–∞
    }
  }
}, [candles, lastUpdateTime]);  // ‚ö° –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ candles
```

### 3. **–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ 60 FPS**

```tsx
useEffect(() => {
  const animate = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawChart(ctx, canvas.width, canvas.height);  // ‚ö° –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
    requestAnimationFrame(animate);  // ‚ö° –°–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä
  };
  
  requestAnimationFrame(animate);
}, [drawChart]);  // ‚ö° –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ drawChart –º–µ–Ω—è–µ—Ç—Å—è
```

---

## üìä –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã:

```
1. setInterval (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫)
        ‚Üì
2. fetch Binance API
        ‚Üì
3. –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ —Å–≤–µ—á–µ–π [—Å–≤–µ—á–∞1, —Å–≤–µ—á–∞2, ..., —Å–≤–µ—á–∞N]
        ‚Üì
4. setCandles(validCandles)  ‚Üê STATE –æ–±–Ω–æ–≤–∏–ª—Å—è
        ‚Üì
5. drawChart –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è (useCallback –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: candles)
        ‚Üì
6. requestAnimationFrame –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π drawChart
        ‚Üì
7. –ë–µ—Ä–µ–º lastCandle = candles[candles.length - 1]
        ‚Üì
8. –†–∏—Å—É–µ–º currentPrice = lastCandle.close
        ‚Üì
9. –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ! üéâ
```

---

## ‚ö° –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

### –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥:
1. –ó–∞–ø—Ä–æ—Å –∫ API ‚Üí –ø–æ–ª—É—á–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
2. `setCandles(–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)` ‚Üí React –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞
3. `drawChart` –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ `candles`
4. –ì—Ä–∞—Ñ–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é —Ü–µ–Ω—É

### 60 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É:
- `requestAnimationFrame` –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç canvas
- –ü—É–ª—å—Å–∏—Ä—É—é—â–∞—è —Ç–æ—á–∫–∞ –∞–Ω–∏–º–∏—Ä—É–µ—Ç—Å—è (`Math.sin(Date.now() * 0.005)`)

---

## üéØ –ü–æ—á–µ–º—É —ç—Ç–æ –±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ:

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
- **–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ** (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫) - –Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç API
- **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–∞—Å—Ç–æ** (60 FPS) - –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```tsx
// 1. useCallback –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏
const drawChart = useCallback(() => { ... }, [candles, lastUpdateTime]);

// 2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ React —Å–ª–µ–¥—è—Ç –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
// drawChart –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ candles –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

// 3. requestAnimationFrame —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å vsync —ç–∫—Ä–∞–Ω–∞
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 60 FPS –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Binance API:

```json
[
  [
    1699632000000,  // Timestamp (kline[0])
    "35000.00",     // Open price (kline[1])
    "35100.00",     // High price (kline[2])
    "34900.00",     // Low price (kline[3])
    "35050.00",     // Close price (kline[4]) ‚Üê –¢–ï–ö–£–©–ê–Ø –¶–ï–ù–ê
    "123.456",      // Volume (kline[5])
    ...
  ],
  ...
]
```

–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–≤–µ—á–∞ –≤ –º–∞—Å—Å–∏–≤–µ = —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (`close` –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–≤–µ—á–∏).

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```tsx
// –ë—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
<CryptoChart updateInterval={5000} />

// –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)
<CryptoChart updateInterval={30000} />

// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
<CryptoChart />
```

**–í–∞–∂–Ω–æ:** Binance API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã.

---

–í—Å—ë! –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Binance API. üöÄ
